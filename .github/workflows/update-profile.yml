name: Update Naukri Name Automatically

on:
  schedule:
    - cron: '0 2-6 * * *'  # Every hour 8 AM to 12 PM IST
  workflow_dispatch:

jobs:
  update-name:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: 3.11

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          playwright install --with-deps

      - name: Run Naukri Name Updater
        env:
          NAUKRI_EMAIL: ${{ secrets.NAUKRI_EMAIL }}
          NAUKRI_PASS: ${{ secrets.NAUKRI_PASS }}
        run: python naukri_update.py

      - name: Upload screenshots (for debugging)
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: debug-screenshots
          path: |
            after_login.png
            profile_loaded.png
            edited_name.png
            name_saved.png

  notify:
    needs: update-name
    runs-on: ubuntu-latest
    if: always()
    steps:
      - name: Notify on Slack
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
        run: |
          curl -X POST -H 'Content-type: application/json' \
            --data '{"text":"âœ… Naukri profile name update job has finished."}' \
            $SLACK_WEBHOOK_URL
